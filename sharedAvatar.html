<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="src/reblium_logo_black.png" />
    <link rel="stylesheet" type="text/css" href="../css/main-menu.css" />
    <link rel="stylesheet" type="text/css" href="../css/chat.css" />
    <title>Reblium Demo</title>

    <!--Google ads link-->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5042550637847830"
      crossorigin="anonymous"
    ></script>

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat&display=swap"
    />

    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
      rel="stylesheet"
    />
    <script
      type="text/javascript"
      src="https://webrtc.github.io/adapter/adapter-latest.js"
    ></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
      integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
      crossorigin="anonymous"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts Link For Icons -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.2.3/css/flag-icons.min.css"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./javascript/env.js"></script>

    <script src="./javascript//Constant.js"></script>
    <script src="main.js"></script>

    <style>
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999999;
      }
      .signup-modal {
        background: rgba(31, 31, 31, 0.78);
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        position: relative;
        width: 70%;
        height: 90%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .signup-modal-close-button {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        color: #666;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0;
      }
      .main-text {
        font-size: 3.5rem;
        font-weight: bold;
        color: #fff;
        margin-bottom: 100px;
      }
      .small-text {
        font-size: 12px;
        color: #fff;
        margin-top: 10px;
      }
      .intro-text {
        color: #fff;
        font-family: Arial;
        font-size: 1.1rem;
        font-style: normal;
        font-weight: 400;
        line-height: normal;
        letter-spacing: 4px;
        text-align: left;
        overflow-y: auto;
      }
      #signUpCancel {
        background: unset;
        border: 1px solid white;
      }
    </style>

    <title>Reblium Avatar System</title>
    <!-- Hotjar Tracking Code for https://reblium.netlify.app/ -->
    <script>
      (function (h, o, t, j, a, r) {
        h.hj =
          h.hj ||
          function () {
            (h.hj.q = h.hj.q || []).push(arguments);
          };
        h._hjSettings = { hjid: 3683678, hjsv: 6 };
        a = o.getElementsByTagName("head")[0];
        r = o.createElement("script");
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
      })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
    </script>
  </head>
  <body>
    <div
      id="modalOverlay"
      class="signup-modal-overlay modal-overlay"
      style="display: none"
    >
      <div class="signup-modal">
        <button id="closeSignUpModal" class="signup-modal-close-button">
          &times;
        </button>
        <div id="signupOption" style="display: block">
          <p class="main-text">SIGN UP TO SAVE <br />YOUR AVATAR</p>
          <div>
            <button
              id="signUpFormBtn"
              class="w-full demo-button menu-button mb-4"
            >
              Sign up
            </button>
          </div>
        </div>
        <div id="signUpFormSection" style="display: none">
          <div
            class="bg-white rounded-lg shadow-xl flex max-w-5xl w-full overflow-hidden"
          >
            <!-- Left side with background image and text -->
            <div
              class="w-1/2 bg-black text-white p-12 flex flex-col justify-between relative hidden md:block"
            >
              <!-- Left side content remains the same -->
              <div class="absolute top-8 left-8" style="width: 95px">
                <img src="./src/Reblium_Icon.ico" alt="log" />
              </div>
              <div class="mt-24">
                <h2 class="text-4xl font-bold mb-12">CREATE YOUR ACCOUNT</h2>
                <ul class="space-y-4 text-lg">
                  <li class="flex items-center">
                    <i class="fas fa-check text-blue-400 mr-4"></i>
                    Generate your avatar using AI
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-check text-blue-400 mr-4"></i>
                    Endless Personalisation
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-check text-blue-400 mr-4"></i>
                    Connect to your own ChatGPT
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-check text-blue-400 mr-4"></i>
                    Share with your network
                  </li>
                </ul>
              </div>
            </div>

            <!-- Right side with form -->
            <div class="w-full md:w-1/2 p-12" id="signupForm">
              <h2 class="text-2xl font-semibold mb-8">Create your account</h2>
              <form id="signupFormElement" class="space-y-6 text-left">
                <div>
                  <label
                    for="name"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Full Name</label
                  >
                  <input
                    type="text"
                    id="name"
                    name="name"
                    class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md"
                    placeholder="Enter your full name"
                    required
                    tabindex="1"
                  />
                </div>
                <div>
                  <label
                    for="email"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Email Address</label
                  >
                  <input
                    type="email"
                    id="email"
                    name="email"
                    class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md"
                    placeholder="demo@reblium.com"
                    required
                    tabindex="2"
                  />
                  <p id="emailError" class="mt-1 text-sm text-red-600 hidden">
                    Please enter a valid email address.
                  </p>
                </div>
                <div>
                  <label
                    for="password"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Password</label
                  >
                  <input
                    type="password"
                    id="password"
                    name="password"
                    class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md"
                    required
                    tabindex="2"
                  />
                </div>
                <div>
                  <label
                    for="confirmPassword"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Confirm Password</label
                  >
                  <input
                    type="password"
                    id="confirmPassword"
                    name="confirmPassword"
                    class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md"
                    required
                    tabindex="3"
                  />
                </div>
                <button
                  type="submit"
                  class="w-full py-2 px-4 border border-transparent rounded-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                >
                  Sign Up
                </button>
              </form>
              <p id="signupMessage" class="mt-4 text-sm"></p>
              <p class="mt-4 text-xs text-gray-500">
                By creating an account, you agree to our Privacy Policy, Terms
                and Conditions and End User License Agreement.
              </p>
              <p class="mt-4 text-sm text-gray-600">
                Already have an account?
                <a href="/" class="text-blue-600 hover:text-blue-500">Log in</a>
              </p>
            </div>

            <div id="verificationLinkSent" class="w-full md:w-1/2 p-12 hidden">
              <h2 class="text-2xl font-semibold mb-8">Verify Your Email</h2>
              <p class="mb-4">
                We've sent a verification link to your email. Please check your
                inbox and click the link to verify your account.
              </p>
              <p class="mb-4">
                Didn't receive the email? Check your spam folder or click the
                button below to receive a verification code instead.
              </p>
              <button
                id="requestCodeButton"
                class="w-full py-2 px-4 border border-transparent rounded-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
              >
                Request Verification Code
              </button>
            </div>

            <div id="verificationForm" class="w-full md:w-1/2 p-12 hidden">
              <h2 class="text-2xl font-semibold mb-6">
                Enter Verification Code
              </h2>
              <p class="mb-4">
                Please enter the 5-digit code sent to your email.
              </p>
              <form id="verificationFormElement" class="space-y-4 text-left">
                <div>
                  <label
                    for="verificationCode"
                    class="block text-sm font-medium text-gray-700 mb-1"
                    >Verification Code</label
                  >
                  <input
                    type="text"
                    id="verificationCode"
                    name="verificationCode"
                    class="block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md"
                    placeholder="Enter 5-digit code"
                  />
                </div>
                <button
                  type="submit"
                  class="w-full py-2 px-4 border border-transparent rounded-md text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                >
                  Verify
                </button>
              </form>
              <p id="verificationMessage" class="mt-4 text-sm"></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="popup" class="popup" style="display: none">
      <form id="avatarForm">
        <span class="close-button">&times;</span>
        <h3>New Persona</h3>
        <img class="avatar-icon" src="src/Default_Avatar_Icon.png" />
        <input type="text" placeholder="Avatar name" id="username" />
        <button type="button" id="confirmButton">Confirm</button>
        <button type="button" id="Signup" style="display: none">Signup</button>
      </form>
    </div>

    <img
      id="signupImage"
      src="src/Finale_Pricing.png"
      style="display: none"
      alt="Signup Visual"
    />

    <!-- API Key Pop-up -->
    <div id="apiPopup" class="apiPopup" style="display: none">
      <form id="apiKeyForm">
        <span id="apiClose" class="close-button">&times;</span>
        <h3>Enter Your ChatGPT Key</h3>
        <br />
        <p>API key save only for this session</p>
        <input
          type="text"
          placeholder="Paste your API key here"
          id="apiKeyInput"
        />
        <button type="button" id="apiKeyConfirmButton">Confirm</button>
      </form>
    </div>

    <!-- Language Selection Pop-up -->
    <div id="languagePopup" class="languagePopup" style="display: none">
      <form id="languageForm">
        <span id="languageClose" class="close-button">&times;</span>
        <h3>Select a Language</h3>
        <ul id="languageList">
          <div
            class="language-option"
            data-lang="English"
            data-lang-code="en-US"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            English
          </div>
          <div
            class="language-option"
            data-lang="Dutch"
            data-lang-code="nl-NL"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Dutch
          </div>
          <div
            class="language-option"
            data-lang="French"
            data-lang-code="fr-FR"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            French
          </div>
          <div
            class="language-option"
            data-lang="Spanish"
            data-lang-code="es-ES"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Spanish
          </div>
          <div
            class="language-option"
            data-lang="German"
            data-lang-code="de-DE"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            German
          </div>
          <div
            class="language-option"
            data-lang="Japanese"
            data-lang-code="ja-JP"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Japanese
          </div>
          <div
            class="language-option"
            data-lang="Mandarin"
            data-lang-code="cmn-Hans-CN"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Mandarin
          </div>
          <div
            class="language-option"
            data-lang="Cantonese"
            data-lang-code="yue-Hant-HK"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Cantonese
          </div>
          <div
            class="language-option"
            data-lang="Arabic"
            data-lang-code="ar-XA"
            style="border: 2px solid rgba(255, 255, 255, 0.3)"
          >
            Arabic
          </div>
        </ul>
      </form>
    </div>

    <!-- Voice Settings Pop-up -->
    <div id="voicePopup" class="voicePopup" style="display: none">
      <form id="voiceForm">
        <span id="voiceClose" class="close-button">&times;</span>
        <h3>Choose a Voice</h3>
        <ul id="voiceList">
          <div class="voice-option selected" data-voice="Female1">Samantha</div>
          <div class="voice-option" data-voice="Male1">Richard</div>
          <div class="voice-option" data-voice="Female2">Emily</div>
          <div class="voice-option" data-voice="Male2">John</div>
        </ul>
      </form>
    </div>

    <!-- Share Pop-up -->
    <div id="sharePopup" class="sharePopup" style="display: none">
      <form id="shareForm">
        <span id="shareClose" class="close-button">&times;</span>
        <h3>Publish</h3>
        <br />
        <p>
          Publishing your avatar to make it public and share with your friends
        </p>
        <input
          type="text"
          placeholder="Copy this link to share"
          id="shareLinkInput"
        />
        <button type="button" id="shareConfirmButton">Copy Link</button>
      </form>
    </div>

    <!-- Persona Pop-up -->
    <div id="personaPopup" class="personaPopup" style="display: none">
      <form id="personaForm">
        <span
          id="personaClose"
          class="close-button"
          style="position: absolute; top: 10px; right: 20px; cursor: pointer"
          >&times;</span
        >
        <h3>Enter Your Prompt</h3>
        <p>
          To save the prompt you need to click on the save button on the bottom
          of the screen
        </p>
        <textarea
          id="personaInput"
          placeholder="Type your persona here"
        ></textarea>
        <button type="button" id="personaConfirmButton">Confirm</button>
      </form>
    </div>

    <!-- Pop-up for DHS file upload -->
    <div id="dhsPopup" class="dhs-popup" style="display: none">
      <form id="dhsForm">
        <span id="dhsClose" class="dhs-close-button">&times;</span>
        <h3>Upload Your DHS File</h3>
        <div class="dhs-dropzone" id="dhsDropzone">
          Drag and drop your DHS file here
        </div>
        <p id="uploadStatus" style="display: none; color: lightgreen">
          File uploaded successfully!
        </p>
        <button type="button" id="dhsConfirmButton">Upload</button>
      </form>
    </div>

    <div id="sizeContainer" style="display: none; position: relative">
      <div id="videoContainer" style="display: none">
        <audio id="audioRef"></audio>

        <div class="fixed-container">
          <div id="previewButton" class="button active invisible">Preview</div>
        </div>
      </div>
      <div id="chatbot" style="display: none">
        <img
          id="chatbotLogo"
          src="src/yourlogopng.png"
          style="
            position: absolute;
            top: 0;
            left: 0;
            margin: 4rem;
            width: 10rem;
            height: 10rem;
          "
        />

        <div id="webcam-container">
          <div class="webcambutton-container">
            <div id="toggle-webcam">Turn on webcam</div>
          </div>
          <div class="webcamVideo-container">
            <video id="webcam" style="display: none"></video>
          </div>
        </div>

        <div
          id="languagesFlags"
          style="
            grid-template-columns: repeat(2, 1fr);
            display: grid;
            border-radius: 8px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 40px;
            z-index: 9999;
            padding: 10px;
          "
        >
          <!-- First Column -->
          <div
            class="language-option"
            data-lang="English"
            data-lang-code="en-US"
            style="
              grid-column: 1;
              grid-row: 1;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-us" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="Dutch"
            data-lang-code="nl-NL"
            style="
              grid-column: 1;
              grid-row: 2;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-nl" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="French"
            data-lang-code="fr-FR"
            style="
              grid-column: 1;
              grid-row: 3;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-fr" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="Spanish"
            data-lang-code="es-ES"
            style="
              grid-column: 1;
              grid-row: 4;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-es" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="German"
            data-lang-code="de-DE"
            style="
              grid-column: 1;
              grid-row: 5;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-de" style="font-size: 2em"></span>
          </div>
          <!-- Second Column -->
          <div
            class="language-option"
            data-lang="Japanese"
            data-lang-code="ja-JP"
            style="
              grid-column: 2;
              grid-row: 1;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-jp" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="Mandarin"
            data-lang-code="cmn-Hans-CN"
            style="
              grid-column: 2;
              grid-row: 2;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-cn" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="Cantonese"
            data-lang-code="yue-Hant-HK"
            style="
              grid-column: 2;
              grid-row: 3;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-hk" style="font-size: 2em"></span>
          </div>
          <div
            class="language-option"
            data-lang="Arabic"
            data-lang-code="ar-XA"
            style="
              grid-column: 2;
              grid-row: 4;
              background: none;
              cursor: pointer;
              font-size: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <span class="fi fi-sa" style="font-size: 2em"></span>
          </div>
        </div>

        <div id="chat-container" class="chat-container">
          <div id="chat-header" class="chat-header">
            <div
              id="muteButton"
              class="muteButton"
              onclick="handleMute()"
              title="Toggle Mute"
            >
              <i class="fas fa-volume-mute" style="color: #ef4444"></i>
            </div>
            <div>
              <div id="close-chat" class="close-chat">
                <i
                  id="clear-chat-history-icon"
                  class="fa fa-trash"
                  aria-hidden="true"
                ></i>
              </div>
            </div>
          </div>
          <div
            id="chatbox"
            class="chat-content"
            tyle="height: calc(100vh - 50vh);"
          >
            <div class="message-container">
              <p class="message-text" style="margin-bottom: 8px">
                Hi there ðŸ‘‹ <br />How can I help you today?
              </p>
            </div>
          </div>
          <div id="chat-input" class="chat-input">
            <div class="chat-input-container">
              <div class="input-wrapper">
                <input
                  id="user-input"
                  onfocus="this.value=''"
                  type="text"
                  placeholder="Type a message..."
                  class="user-input-field"
                />
                <div id="send-button" class="send-button">
                  <svg
                    id="send_button"
                    style="color: white"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    width="24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"
                    />
                  </svg>
                </div>
              </div>
              <div id="call-button" class="call-button">
                <svg
                  class=""
                  fill="#FFFFFF"
                  height="25px"
                  width="25px"
                  version="1.1"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  enable-background="new 0 0 512 512"
                >
                  <g>
                    <g>
                      <path
                        d="m439.5,236c0-11.3-9.1-20.4-20.4-20.4s-20.4,9.1-20.4,20.4c0,70-64,126.9-142.7,126.9-78.7,0-142.7-56.9-142.7-126.9 0-11.3-9.1-20.4-20.4-20.4s-20.4,9.1-20.4,20.4c0,86.2 71.5,157.4 163.1,166.7v57.5h-23.6c-11.3,0-20.4,9.1-20.4,20.4 0,11.3 9.1,20.4 20.4,20.4h88c11.3,0 20.4-9.1 20.4-20.4 0-11.3-9.1-20.4-20.4-20.4h-23.6v-57.5c91.6-9.3 163.1-80.5 163.1-166.7z"
                      />
                      <path
                        d="m256,323.5c51,0 92.3-41.3 92.3-92.3v-127.9c0-51-41.3-92.3-92.3-92.3s-92.3,41.3-92.3,92.3v127.9c0,51 41.3,92.3 92.3,92.3zm-52.3-220.2c0-28.8 23.5-52.3 52.3-52.3s52.3,23.5 52.3,52.3v127.9c0,28.8-23.5,52.3-52.3,52.3s-52.3-23.5-52.3-52.3v-127.9z"
                      />
                    </g>
                  </g>
                </svg>
              </div>
              <div id="stopcall-button" class="stopcall-button">
                <img
                  src="src/Microphone.gif"
                  alt="Microphone Animation"
                  style="width: 100%; height: auto"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="artist_mode" id="artist_mode" style="display: block">
        <div class="loader-overlay">
          <div class="loader">
            <img
              class="w-full h-full mb-8"
              src="./src/reblium_logo.png"
              alt="logn"
            />
            <p class="text-white">Lining up...</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const closeModalBtn = document.getElementById("closeSignUpModal");

      const signUpLoginBtn = document.getElementById("signUpLogin");
      const modalOverlay = document.getElementById("modalOverlay");
      const signupOption = document.getElementById("signupOption");
      const signUpFormBtn = document.getElementById("signUpFormBtn");
      const signUpFormSection = document.getElementById("signUpFormSection");

      async function initializeEverything() {
        await waitForVideoLoad();
        await fetchAndDisplayAvatar();
        initPreviewMode();
      }

      document.addEventListener("DOMContentLoaded", function () {
        initializeEverything();
      });

      setInterval(() => {
        showSignUpModal();
      }, 60000);

      signUpFormBtn.addEventListener("click", () => {
        signUpFormSection.style.display = "block";
        signupOption.style.display = "none";
      });

      closeModalBtn.addEventListener("click", () => {
        modalOverlay.style.display = "none";
        signupOption.style.display = "none";
        signUpFormSection.style.display = "none";
      });

      modalOverlay.addEventListener("click", (e) => {
        if (e.target === modalOverlay) {
          modalOverlay.style.display = "none";
        }
      });

      function cancelSignUpOption() {
        signupOption.style.display = "none";
        modalOverlay.style.display = "none";
      }

      function showSignUpModal() {
        if (
          checkDisplayStatus(modalOverlay, "flex") &&
          checkDisplayStatus(signUpFormSection, "block")
        ) {
          return;
        } else {
          modalOverlay.style.display = "flex";
          signupOption.style.display = "block";
          signUpFormSection.style.display = "none";
        }
      }

      function decryptData(encryptedData) {
        // Reverse the base64url encoding
        const base64 = encryptedData.replace(/-/g, "+").replace(/_/g, "/");
        const paddedBase64 = base64.padEnd(
          base64.length + ((4 - (base64.length % 4)) % 4),
          "="
        );

        let decrypted = atob(paddedBase64);
        let result = "";
        for (let i = 0; i < decrypted.length; i++) {
          const charCode =
            decrypted.charCodeAt(i) ^
            ENCRYPTION_KEY.charCodeAt(i % ENCRYPTION_KEY.length);
          result += String.fromCharCode(charCode);
        }

        // Split the decrypted string back into avatarId and userId
        const [avatarId, userId] = result.split("|");
        return { avatarId, userId };
      }

      async function fetchAndDisplayAvatar() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const encryptedData = urlParams.get("data");

        const { avatarId, userId } = decryptData(encryptedData);

        if (avatarId) {
          try {
            const response = await fetch(
              `/.netlify/functions/avatar/getUserAvatar/${avatarId}`
            );
            const data = await response.json();
            const { avatarData } = data;

            setTimeout(() => {
              handleSendCommands({
                resetavatar: JSON.stringify(avatarData.Avatar),
              });
            }, 1000);
          } catch (error) {
            console.error("Failed to fetch avatar:", error);
          }
        } else {
          window.location.href = "/";
        }

        if (avatarId && userId) {
          try {
            const response = await fetch(
              `/.netlify/functions/UserPrompts/getUserPrompts?user_id=${userId}&avatar_id=${avatarId}`
            );
            const { success, data } = await response.json();
            if (!success) {
              handleSendCommands({
                texttospeech:
                  "Hi, I am a Rebelium assistant. How can I help you?",
              });
            } else {
              const welcomeMessage = data.welcome_message;
              handleSendCommands({ texttospeech: welcomeMessage });
            }
          } catch (error) {
            console.error("Error fetching user prompt data:", error);
            return null;
          }
        }
      }

      function initPreviewMode() {
        const chatbot = document.getElementById("chatbot");
        const previewButton = document.getElementById("previewButton");
        const elementsToShow = document.querySelectorAll("#chatbot > *");
        const logo = document.getElementById("chatbotLogo");
        const chatContainer = document.getElementById("chat-container");
        const languagesFlags = document.getElementById("languagesFlags");
        const webcamContainer = document.getElementById("webcam-container");

        // Reset all elements to be shown
        elementsToShow.forEach((element) => {
          element.style.display = "block";
        });

        // Manage display based on selected button
        elementsToShow.forEach((element) => {
          if (
            element !== logo &&
            element !== chatContainer &&
            element !== languagesFlags
          ) {
            element.style.display = "none";
          }
        });
        webcamContainer.style.display = "block";
        languagesFlags.style.display = "grid";
        languagesFlags.style.gridTemplateColumns = "repeat(2, 1fr)";

        chatbot.style.display = "block";
        chatbot.focus();
        handleSendCommands({ cameraswitch: "Head" });

        audioRef.muted = false;
        audioRef.play();
        icon.className = "fas fa-volume-up";
      }

  </script>

    <script src="javascript/signup.js"></script>

    <script src="javascript/chatbot_dashboard.js"></script>

    <script src="javascript/frondend.js"></script>

    <script src="javascript/arc_module.js" type="module"></script>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"
      integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em"
      crossorigin="anonymous"
    ></script>

    <script src="javascript/range-slider.js"></script>
    <script>
      OmRangeSlider.init({
        inputValueStyle: OmRangeSliderInputValueStyles.ASP_ARRAY,
      });
    </script>
  </body>
</html>
